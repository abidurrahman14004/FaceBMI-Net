<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samples - BMI Predictor</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-gradient-primary">
    <div class="container-fluid p-0">
        <div class="row g-0 min-vh-100">
            <!-- Left Sidebar Navigation -->
            <aside class="col-lg-3 col-xl-2 sidebar-custom">
                <div class="sidebar-content p-4 h-100 d-flex flex-column">
                    <div class="sidebar-header mb-4 pb-3 border-bottom border-light border-opacity-25">
                        <h1 class="h3 mb-2 text-white fw-bold">
                            <i class="bi bi-robot"></i> BMI Predictor
                        </h1>
                        <p class="text-white-50 small mb-0">AI-Powered Analysis</p>
                    </div>
                    
                    <nav class="sidebar-nav flex-grow-1">
                        <ul class="nav flex-column gap-2">
                            <li class="nav-item">
                                <a href="/" class="nav-link-custom">
                                    <i class="bi bi-house me-2"></i>
                                    <span>Home</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/samples" class="nav-link-custom active">
                                    <i class="bi bi-images me-2"></i>
                                    <span>Samples</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/privacy-policy" class="nav-link-custom">
                                    <i class="bi bi-shield-lock me-2"></i>
                                    <span>Privacy Policy</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="col-lg-9 col-xl-10 main-content-custom">
                <div class="p-4 p-md-5">
                    <div class="mb-4">
                        <h2 class="text-white fw-bold mb-3">Sample Images with True BMI Values</h2>
                    </div>
                    
                    <div class="card shadow-lg border-0">
                        <div class="card-body p-4 p-md-5">
                            <div class="mb-4">
                                <div class="row g-3 mb-4">
                                    <div class="col-md-4">
                                        <label for="minBMI" class="form-label">Min BMI</label>
                                        <input type="number" class="form-control" id="minBMI" min="0" max="50" value="0" step="0.1">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="maxBMI" class="form-label">Max BMI</label>
                                        <input type="number" class="form-control" id="maxBMI" min="0" max="50" value="50" step="0.1">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="numSamples" class="form-label">Number of Samples</label>
                                        <input type="number" class="form-control" id="numSamples" min="1" max="100" value="10" step="1">
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="loadSamples()">
                                    <i class="bi bi-search me-2"></i>Filter Samples
                                </button>
                            </div>
                            
                            <div id="samplesInfo" class="alert alert-info mb-4" style="display: none;"></div>
                            <div id="samplesGrid" class="row g-4">
                                <div class="col-12 text-center">
                                    <p class="text-muted">Click "Filter Samples" to load samples</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function loadSamples() {
            const minBMI = parseFloat(document.getElementById('minBMI').value) || 0;
            const maxBMI = parseFloat(document.getElementById('maxBMI').value) || 50;
            const numSamples = parseInt(document.getElementById('numSamples').value) || 10;
            
            const grid = document.getElementById('samplesGrid');
            const info = document.getElementById('samplesInfo');
            grid.innerHTML = '<div class="col-12 text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2 text-muted">Loading samples...</p></div>';
            
            try {
                const response = await fetch('/api/samples');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    grid.innerHTML = `<div class="col-12"><div class="alert alert-danger"><i class="bi bi-exclamation-triangle me-2"></i>${data.error}</div></div>`;
                    return;
                }
                
                if (!data.samples || data.samples.length === 0) {
                    grid.innerHTML = '<div class="col-12"><div class="alert alert-warning">No samples found in the dataset.</div></div>';
                    return;
                }
                
                // Filter by BMI range
                let samples = data.samples.filter(s => {
                    const bmi = parseFloat(s.BMI);
                    return !isNaN(bmi) && bmi >= minBMI && bmi <= maxBMI;
                });
                
                if (samples.length === 0) {
                    grid.innerHTML = `<div class="col-12"><div class="alert alert-warning">No samples found in the specified BMI range (${minBMI} - ${maxBMI}).</div></div>`;
                    info.style.display = 'block';
                    info.textContent = `Total samples in dataset: ${data.total}`;
                    return;
                }
                
                // Limit to requested number
                if (samples.length > numSamples) {
                    // Random sample
                    samples = samples.sort(() => 0.5 - Math.random()).slice(0, numSamples);
                }
                
                info.style.display = 'block';
                if (data.total === 0) {
                    info.className = 'alert alert-warning mb-4';
                    info.innerHTML = `<i class="bi bi-exclamation-triangle me-2"></i>No samples with images found. Please ensure images are placed in: <code>samples/front/</code>`;
                } else {
                    info.className = 'alert alert-info mb-4';
                    info.innerHTML = `<i class="bi bi-info-circle me-2"></i>Showing <strong>${samples.length}</strong> sample(s) (Total available with images: ${data.total})`;
                }
                
                grid.innerHTML = '';
                samples.forEach((sample, index) => {
                    const col = document.createElement('div');
                    col.className = 'col-md-3 col-sm-6 mb-4';
                    
                    const bmiValue = parseFloat(sample.BMI).toFixed(2);
                    const imageUrl = `/samples/front/${encodeURIComponent(sample.image_filename)}`;
                    const safeFilename = sample.image_filename.replace(/'/g, "\\'");
                    const sampleId = sample.id || sample.image_filename.replace('.jpg', '').replace('.png', '');
                    const safeId = sampleId.replace(/'/g, "\\'");
                    
                    // Determine BMI category
                    let bmiCategory = '';
                    let categoryColor = '#667eea';
                    if (bmiValue < 18.5) {
                        bmiCategory = 'Underweight';
                        categoryColor = '#17a2b8';
                    } else if (bmiValue < 25) {
                        bmiCategory = 'Normal';
                        categoryColor = '#28a745';
                    } else if (bmiValue < 30) {
                        bmiCategory = 'Overweight';
                        categoryColor = '#ffc107';
                    } else {
                        bmiCategory = 'Obese';
                        categoryColor = '#dc3545';
                    }
                    
                    col.innerHTML = `
                        <div class="card shadow-sm h-100">
                            <div class="card-img-wrapper" style="height: 200px; overflow: hidden; background: #f0f0f0; display: flex; align-items: center; justify-content: center; position: relative;">
                                <img src="${imageUrl}" 
                                     class="card-img-top" 
                                     style="object-fit: cover; width: 100%; height: 100%; cursor: pointer;"
                                     onerror="this.onerror=null; this.style.display='none'; const placeholder = this.parentElement.querySelector('.image-placeholder'); if(placeholder) placeholder.style.display='flex';"
                                     alt="${safeFilename}"
                                     onclick="window.open('${imageUrl}', '_blank')">
                                <div class="image-placeholder" style="display: none; text-align: center; padding: 2rem; width: 100%; height: 100%; color: white; position: absolute; top: 0; left: 0; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    <i class="bi bi-person-circle" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.8;"></i>
                                    <p class="mb-1 fw-bold" style="font-size: 1.2rem; margin: 0; color: white;">BMI: ${bmiValue}</p>
                                    <p class="mb-0 small" style="opacity: 0.9; color: white;">${bmiCategory}</p>
                                    <p class="mt-2 small" style="opacity: 0.7; font-size: 0.75rem; color: white;">${safeId}</p>
                                </div>
                            </div>
                            <div class="card-body text-center p-3">
                                <h6 class="card-title mb-1" style="color: ${categoryColor}; font-weight: bold; font-size: 1.1rem;">BMI: ${bmiValue}</h6>
                                <small class="text-muted d-block mb-1">${bmiCategory}</small>
                                <small class="text-muted" style="font-size: 0.7rem;">ID: ${safeId}</small>
                            </div>
                        </div>
                    `;
                    grid.appendChild(col);
                });
            } catch (error) {
                console.error('Error loading samples:', error);
                grid.innerHTML = `<div class="col-12"><div class="alert alert-danger"><i class="bi bi-exclamation-triangle me-2"></i>Error loading samples: ${error.message}<br><small>Please check the browser console for more details.</small></div></div>`;
            }
        }
        
        // Load samples on page load
        window.addEventListener('DOMContentLoaded', function() {
            loadSamples();
        });
    </script>
</body>
</html>
